---

- name: Needed for accelerated mode
  hosts: all
  sudo: yes
  roles:
    - { role: geerlingguy.repo-epel }
  tasks:
    - yum: name=python-keyczar state=latest
    - service: name=iptables state=stopped enabled=no
    - lineinfile: state=present create=yes dest=/etc/sudoers.d/888-dont-requiretty line="Defaults !requiretty" backup=yes

- name: Apply common configuration to all target nodes
  hosts: all
  tags: [common]
  #accelerate: True
  sudo: yes
  roles:
    - common
    - ambari-repo
  tasks:
    - name: update hostname
      command: hostname "{{hostname}}"

- name: Ambari agent
  tags: [ambari, agent]
  hosts: all
  #accelerate: True
  sudo: yes
  roles:
    - role: ambari-agent
      manual_registration: yes

- name: Ambari server
  tags: [ambari, server]
  hosts: ambari
  #accelerate: True
  sudo: yes
  roles:
    - ambari-server

- name: run the blueprint
  tags: [ambari, blueprint]
  hosts: ambari
  sudo: yes
  roles:
    - blueprint
